{"version":3,"file":"custom.js","names":["_kleur","_interopRequireDefault","require","_path","_fsExtra","_spawn","_del","e","__esModule","default","customTarget","options","root","report","script","Error","kleur","green","pathToClean","clean","path","relative","undefined","info","blue","del","resolve","packageManagerExecutable","process","env","npm_execpath","packageManagerArgs","packageManagerName","basename","join","spawn","stdio","success","fs","pathExists","warn","bold"],"sources":["../../src/targets/custom.ts"],"sourcesContent":["import kleur from 'kleur';\nimport path from 'path';\nimport fs from 'fs-extra';\nimport type { Input } from '../types';\nimport { spawn } from '../utils/spawn';\nimport del from 'del';\n\ntype Options = Omit<Input, 'output'> & {\n  options?: {\n    script?: string;\n    clean?: string;\n  };\n};\n\nexport default async function customTarget({ options, root, report }: Options) {\n  if (options?.script == null) {\n    throw new Error(\n      `No 'script' was provided with the custom target. Example: ${kleur.green(\n        '{[\"custom\", { \"script\": \"generateTypes\" }}'\n      )}`\n    );\n  }\n\n  const pathToClean = options.clean\n    ? path.relative(root, options.clean)\n    : undefined;\n\n  if (pathToClean) {\n    report.info(`Cleaning up ${kleur.blue(pathToClean)}`);\n\n    await del([path.resolve(root, pathToClean)]);\n  }\n\n  const packageManagerExecutable = process.env.npm_execpath ?? 'npm';\n  const packageManagerArgs = ['run', options.script];\n\n  // usr/bin/yarn -> yarn\n  const packageManagerName = path.basename(packageManagerExecutable);\n  report.info(\n    `Running ${kleur.blue(packageManagerName)} ${kleur.blue(\n      packageManagerArgs.join(' ')\n    )}`\n  );\n\n  await spawn(packageManagerExecutable, packageManagerArgs, {\n    stdio: ['ignore', 'ignore', 'inherit'],\n  });\n\n  report.success(`Ran the ${kleur.blue(options.script)} script succesfully`);\n\n  if (options.clean && pathToClean && !(await fs.pathExists(pathToClean))) {\n    report.warn(\n      `Custom target with the ${kleur.blue(\n        options.script\n      )} script has ${kleur.blue(options.clean)} as the ${kleur.bold(\n        'clean'\n      )} option but this path wasn't created after running the script. Are you sure you've defined the ${kleur.bold(\n        'clean'\n      )} path correctly?`\n    );\n  }\n}\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,KAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,QAAA,GAAAH,sBAAA,CAAAC,OAAA;AAEA,IAAAG,MAAA,GAAAH,OAAA;AACA,IAAAI,IAAA,GAAAL,sBAAA,CAAAC,OAAA;AAAsB,SAAAD,uBAAAM,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AASP,eAAeG,YAAYA,CAAC;EAAEC,OAAO;EAAEC,IAAI;EAAEC;AAAgB,CAAC,EAAE;EAC7E,IAAIF,OAAO,EAAEG,MAAM,IAAI,IAAI,EAAE;IAC3B,MAAM,IAAIC,KAAK,CACb,6DAA6DC,cAAK,CAACC,KAAK,CACtE,4CACF,CAAC,EACH,CAAC;EACH;EAEA,MAAMC,WAAW,GAAGP,OAAO,CAACQ,KAAK,GAC7BC,aAAI,CAACC,QAAQ,CAACT,IAAI,EAAED,OAAO,CAACQ,KAAK,CAAC,GAClCG,SAAS;EAEb,IAAIJ,WAAW,EAAE;IACfL,MAAM,CAACU,IAAI,CAAC,eAAeP,cAAK,CAACQ,IAAI,CAACN,WAAW,CAAC,EAAE,CAAC;IAErD,MAAM,IAAAO,YAAG,EAAC,CAACL,aAAI,CAACM,OAAO,CAACd,IAAI,EAAEM,WAAW,CAAC,CAAC,CAAC;EAC9C;EAEA,MAAMS,wBAAwB,GAAGC,OAAO,CAACC,GAAG,CAACC,YAAY,IAAI,KAAK;EAClE,MAAMC,kBAAkB,GAAG,CAAC,KAAK,EAAEpB,OAAO,CAACG,MAAM,CAAC;;EAElD;EACA,MAAMkB,kBAAkB,GAAGZ,aAAI,CAACa,QAAQ,CAACN,wBAAwB,CAAC;EAClEd,MAAM,CAACU,IAAI,CACT,WAAWP,cAAK,CAACQ,IAAI,CAACQ,kBAAkB,CAAC,IAAIhB,cAAK,CAACQ,IAAI,CACrDO,kBAAkB,CAACG,IAAI,CAAC,GAAG,CAC7B,CAAC,EACH,CAAC;EAED,MAAM,IAAAC,YAAK,EAACR,wBAAwB,EAAEI,kBAAkB,EAAE;IACxDK,KAAK,EAAE,CAAC,QAAQ,EAAE,QAAQ,EAAE,SAAS;EACvC,CAAC,CAAC;EAEFvB,MAAM,CAACwB,OAAO,CAAC,WAAWrB,cAAK,CAACQ,IAAI,CAACb,OAAO,CAACG,MAAM,CAAC,qBAAqB,CAAC;EAE1E,IAAIH,OAAO,CAACQ,KAAK,IAAID,WAAW,IAAI,EAAE,MAAMoB,gBAAE,CAACC,UAAU,CAACrB,WAAW,CAAC,CAAC,EAAE;IACvEL,MAAM,CAAC2B,IAAI,CACT,0BAA0BxB,cAAK,CAACQ,IAAI,CAClCb,OAAO,CAACG,MACV,CAAC,eAAeE,cAAK,CAACQ,IAAI,CAACb,OAAO,CAACQ,KAAK,CAAC,WAAWH,cAAK,CAACyB,IAAI,CAC5D,OACF,CAAC,kGAAkGzB,cAAK,CAACyB,IAAI,CAC3G,OACF,CAAC,kBACH,CAAC;EACH;AACF","ignoreList":[]}