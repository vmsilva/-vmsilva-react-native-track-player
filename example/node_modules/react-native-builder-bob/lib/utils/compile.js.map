{"version":3,"file":"compile.js","names":["_path","_interopRequireDefault","require","_fsExtra","_kleur","babel","_interopRequireWildcard","_glob","_isCodegenSpec","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","sourceExt","compile","root","source","output","esm","babelrc","configFile","exclude","modules","copyFlow","sourceMaps","report","jsxRuntime","variants","files","glob","sync","cwd","absolute","nodir","ignore","info","kleur","blue","String","length","path","relative","pkg","JSON","parse","fs","readFile","join","keys","devDependencies","includes","warn","mkdirp","writeJSON","type","Promise","all","map","filepath","outputFilename","replace","dirname","test","copy","content","codegenEnabled","isCodegenSpec","result","transformAsync","caller","name","supportsStaticESM","rewriteImportExtensions","sourceRoot","sourceFileName","filename","presets","resolve","Error","code","mapFilename","basename","sourcesContent","undefined","writeFile","success","getGeneratedEntryPath","ext","indexName","potentialPath","pathExists","fields","commonjs","module","push","value","main","exports","import","generatedEntryPath","some","field","startsWith","error","cause"],"sources":["../../src/utils/compile.ts"],"sourcesContent":["import path from 'path';\nimport fs from 'fs-extra';\nimport kleur from 'kleur';\nimport * as babel from '@babel/core';\nimport glob from 'glob';\nimport type { Input, Variants } from '../types';\nimport { isCodegenSpec } from './isCodegenSpec';\n\nexport type CompileOptions = {\n  esm?: boolean;\n  babelrc?: boolean | null;\n  configFile?: string | false | null;\n  sourceMaps?: boolean;\n  copyFlow?: boolean;\n  jsxRuntime?: 'automatic' | 'classic';\n};\n\ntype Options = Input &\n  CompileOptions & {\n    modules: 'commonjs' | 'preserve';\n    variants: Variants;\n    exclude: string;\n  };\n\nconst sourceExt = /\\.([cm])?[jt]sx?$/;\n\nexport default async function compile({\n  root,\n  source,\n  output,\n  esm = false,\n  babelrc = false,\n  configFile = false,\n  exclude,\n  modules,\n  copyFlow,\n  sourceMaps = true,\n  report,\n  jsxRuntime = 'automatic',\n  variants,\n}: Options) {\n  const files = glob.sync('**/*', {\n    cwd: source,\n    absolute: true,\n    nodir: true,\n    ignore: exclude,\n  });\n\n  report.info(\n    `Compiling ${kleur.blue(String(files.length))} files in ${kleur.blue(\n      path.relative(root, source)\n    )} with ${kleur.blue('babel')}`\n  );\n\n  const pkg = JSON.parse(\n    await fs.readFile(path.join(root, 'package.json'), 'utf-8')\n  );\n\n  if (copyFlow) {\n    if (!Object.keys(pkg.devDependencies || {}).includes('flow-bin')) {\n      report.warn(\n        `The ${kleur.blue(\n          'copyFlow'\n        )} option was specified, but couldn't find ${kleur.blue(\n          'flow-bin'\n        )} in ${kleur.blue(\n          'package.json'\n        )}.\\nIf the project is using ${kleur.blue(\n          'flow'\n        )}, then make sure you have added ${kleur.blue(\n          'flow-bin'\n        )} to your ${kleur.blue(\n          'devDependencies'\n        )}, otherwise remove the ${kleur.blue('copyFlow')} option.`\n      );\n    }\n  }\n\n  await fs.mkdirp(output);\n\n  // Imports are not rewritten to include the extension if `esm` is not enabled\n  // Ideally we should always treat ESM syntax as CommonJS if `esm` is not enabled\n  // This would maintain compatibility for legacy setups where `import`/`export` didn't require file extensions\n  // However NextJS has non-standard behavior and breaks if we add `type: 'commonjs'` for code with import/export\n  // So we skip generating `package.json` if `esm` is not enabled and `modules` is not `commonjs`\n  // This means that user can't use `type: 'module'` in root `package.json` without enabling `esm` for `module` target\n  if (esm || modules === 'commonjs') {\n    await fs.writeJSON(path.join(output, 'package.json'), {\n      type: modules === 'commonjs' ? 'commonjs' : 'module',\n    });\n  }\n\n  await Promise.all(\n    files.map(async (filepath) => {\n      const outputFilename = path\n        .join(output, path.relative(source, filepath))\n        .replace(sourceExt, '.$1js');\n\n      await fs.mkdirp(path.dirname(outputFilename));\n\n      if (!sourceExt.test(filepath)) {\n        // Copy files which aren't source code\n        await fs.copy(filepath, outputFilename);\n        return;\n      }\n\n      const content = await fs.readFile(filepath, 'utf-8');\n\n      // If codegen is used in the app, then we need to preserve TypeScript source\n      // So we copy the file as is instead of transforming it\n      const codegenEnabled = 'codegenConfig' in pkg;\n\n      if (codegenEnabled && isCodegenSpec(filepath)) {\n        await fs.copy(\n          filepath,\n          path.join(output, path.relative(source, filepath))\n        );\n        return;\n      }\n\n      const result = await babel.transformAsync(content, {\n        caller: {\n          name: 'react-native-builder-bob',\n          supportsStaticESM:\n            /\\.m[jt]s$/.test(filepath) || // If a file is explicitly marked as ESM, then preserve the syntax\n            modules === 'preserve'\n              ? true\n              : false,\n          rewriteImportExtensions: esm,\n          jsxRuntime,\n          codegenEnabled,\n        },\n        cwd: root,\n        babelrc: babelrc,\n        configFile: configFile,\n        sourceMaps,\n        sourceRoot: path.relative(path.dirname(outputFilename), source),\n        sourceFileName: path.relative(source, filepath),\n        filename: filepath,\n        ...(babelrc || configFile\n          ? null\n          : {\n              presets: [require.resolve('../../babel-preset')],\n            }),\n      });\n\n      if (result == null) {\n        throw new Error('Output code was null');\n      }\n\n      let code = result.code || '';\n\n      if (sourceMaps && result.map) {\n        const mapFilename = outputFilename + '.map';\n\n        code += '\\n//# sourceMappingURL=' + path.basename(mapFilename);\n\n        // Don't inline the source code, it can be retrieved from the source file\n        result.map.sourcesContent = undefined;\n\n        await fs.writeJSON(mapFilename, result.map);\n      }\n\n      await fs.writeFile(outputFilename, code);\n\n      if (copyFlow) {\n        await fs.copy(filepath, outputFilename + '.flow');\n      }\n    })\n  );\n\n  report.success(`Wrote files to ${kleur.blue(path.relative(root, output))}`);\n\n  const getGeneratedEntryPath = async () => {\n    if (pkg.source) {\n      for (const ext of ['.js', '.cjs', '.mjs']) {\n        const indexName =\n          // The source field may not have an extension, so we add it instead of replacing directly\n          path.basename(pkg.source).replace(sourceExt, '') + ext;\n\n        const potentialPath = path.join(\n          output,\n          path.dirname(path.relative(source, path.join(root, pkg.source))),\n          indexName\n        );\n\n        if (await fs.pathExists(potentialPath)) {\n          return path.relative(root, potentialPath);\n        }\n      }\n    }\n\n    return null;\n  };\n\n  const fields: { name: string; value: string | undefined }[] = [];\n\n  if (variants.commonjs && variants.module) {\n    if (modules === 'commonjs') {\n      fields.push({ name: 'main', value: pkg.main });\n    } else {\n      fields.push({ name: 'module', value: pkg.module });\n    }\n  } else {\n    fields.push({ name: 'main', value: pkg.main });\n  }\n\n  if (esm) {\n    if (variants.commonjs && variants.module) {\n      if (modules === 'commonjs') {\n        fields.push(\n          typeof pkg.exports?.['.']?.require === 'string'\n            ? {\n                name: \"exports['.'].require\",\n                value: pkg.exports?.['.']?.require,\n              }\n            : {\n                name: \"exports['.'].require.default\",\n                value: pkg.exports?.['.']?.require?.default,\n              }\n        );\n      } else {\n        fields.push(\n          typeof pkg.exports?.['.']?.import === 'string'\n            ? {\n                name: \"exports['.'].import\",\n                value: pkg.exports?.['.']?.import,\n              }\n            : {\n                name: \"exports['.'].import.default\",\n                value: pkg.exports?.['.']?.import?.default,\n              }\n        );\n      }\n    } else {\n      fields.push({\n        name: \"exports['.'].default\",\n        value: pkg.exports?.['.']?.default,\n      });\n    }\n  } else {\n    if (modules === 'commonjs' && pkg.exports?.['.']?.require) {\n      report.warn(\n        `The ${kleur.blue('esm')} option is disabled, but the ${kleur.blue(\n          \"exports['.'].require\"\n        )} field is set in ${kleur.blue(\n          'package.json'\n        )}. This is likely a mistake.`\n      );\n    } else if (modules === 'preserve' && pkg.exports?.['.']?.import) {\n      report.warn(\n        `The ${kleur.blue('esm')} option is disabled, but the ${kleur.blue(\n          \"exports['.'].import\"\n        )} field is set in ${kleur.blue(\n          'package.json'\n        )}. This is likely a mistake.`\n      );\n    }\n  }\n\n  const generatedEntryPath = await getGeneratedEntryPath();\n\n  if (fields.some((field) => field.value)) {\n    for (const { name, value } of fields) {\n      if (!value) {\n        continue;\n      }\n\n      if (name.startsWith('exports') && value && !/^\\.\\//.test(value)) {\n        report.error(\n          `The ${kleur.blue(name)} field in ${kleur.blue(\n            `package.json`\n          )} should be a relative path starting with ${kleur.blue(\n            './'\n          )}. Found: ${kleur.blue(value)}`\n        );\n\n        throw new Error(`Found incorrect path in '${name}' field.`);\n      }\n\n      try {\n        require.resolve(path.join(root, value));\n      } catch (e: unknown) {\n        if (\n          e != null &&\n          typeof e === 'object' &&\n          'code' in e &&\n          e.code === 'MODULE_NOT_FOUND'\n        ) {\n          if (!generatedEntryPath) {\n            report.warn(\n              `Failed to detect the entry point for the generated files. Make sure you have a valid ${kleur.blue(\n                'source'\n              )} field in your ${kleur.blue('package.json')}.`\n            );\n          }\n\n          report.error(\n            `The ${kleur.blue(name)} field in ${kleur.blue(\n              'package.json'\n            )} points to a non-existent file: ${kleur.blue(\n              value\n            )}.\\nVerify the path points to the correct file under ${kleur.blue(\n              path.relative(root, output)\n            )}${\n              generatedEntryPath\n                ? ` (found ${kleur.blue(generatedEntryPath)}).`\n                : '.'\n            }`\n          );\n\n          throw new Error(`Found incorrect path in '${name}' field.`, {\n            cause: e,\n          });\n        }\n\n        throw e;\n      }\n    }\n\n    if (generatedEntryPath) {\n      if (\n        modules === 'commonjs' &&\n        pkg.exports?.['.']?.import === `./${generatedEntryPath}`\n      ) {\n        report.warn(\n          `The the ${kleur.blue(\n            \"exports['.'].import\"\n          )} field points to a CommonJS module. This is likely a mistake.`\n        );\n      } else if (\n        modules === 'preserve' &&\n        pkg.exports?.['.']?.require === `./${generatedEntryPath}`\n      ) {\n        report.warn(\n          `The the ${kleur.blue(\n            \"exports['.'].import\"\n          )} field points to a ES module. This is likely a mistake.`\n        );\n      }\n    }\n  } else {\n    report.warn(\n      `No ${fields\n        .map((field) => kleur.blue(field.name))\n        .join(' or ')} field found in ${kleur.blue('package.json')}. Consider ${\n        generatedEntryPath\n          ? `pointing to ${kleur.blue(generatedEntryPath)}`\n          : `adding ${fields.length > 1 ? 'them' : 'it'}`\n      } so that consumers of your package can import your package.`\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}