{"version":3,"file":"babel.js","names":["_fs","_interopRequireDefault","require","_path","_isCodegenSpec","e","__esModule","default","extensions","isFile","filename","exists","fs","lstatSync","throwIfNoEntry","isDirectory","isModuleWithoutPlatform","extension","platforms","exts","some","ext","every","platform","isTypeImport","node","importKind","exportKind","assertFilename","Error","_default","api","assertVersion","codegenEnabled","caller","addExtension","state","source","value","startsWith","path","resolve","dirname","isCodegenSpec","replace","join","name","visitor","ImportDeclaration","ExportNamedDeclaration","ExportAllDeclaration"],"sources":["../src/babel.ts"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport type { ConfigAPI, NodePath, PluginObj, PluginPass } from '@babel/core';\nimport type {\n  ImportDeclaration,\n  ExportAllDeclaration,\n  ExportNamedDeclaration,\n} from '@babel/types';\nimport { isCodegenSpec } from './utils/isCodegenSpec';\n\ntype Options = {\n  /**\n   * Extension to add to the imports\n   * For commonjs use 'cjs' and for esm use 'mjs'\n   * NodeJS requires explicit extension for esm\n   * The `cjs` extension avoids disambiguity when package.json has \"type\": \"module\"\n   */\n  extension?: 'js' | 'cjs' | 'mjs';\n  /**\n   * Out of tree platforms to support\n   * For `import './file'`, we skip adding extension if `file.${platform}.ts` exists\n   * This is necessary for the platform specific extensions to be resolve correctly\n   * Bundlers won't resolve the platform specific extension if explicit extension is present\n   */\n  platforms?: string[];\n};\n\nconst extensions = ['ts', 'tsx', 'js', 'jsx'];\n\nconst isFile = (filename: string): boolean => {\n  const exists =\n    fs.lstatSync(filename, { throwIfNoEntry: false })?.isFile() ?? false;\n\n  return exists;\n};\n\nconst isDirectory = (filename: string): boolean => {\n  const exists =\n    fs.lstatSync(filename, { throwIfNoEntry: false })?.isDirectory() ?? false;\n\n  return exists;\n};\n\nconst isModuleWithoutPlatform = (\n  filename: string,\n  extension: string,\n  platforms: string[]\n): boolean => {\n  const exts = [...extensions, extension];\n\n  return exts.some(\n    (ext) =>\n      isFile(`${filename}.${ext}`) &&\n      platforms.every((platform) => !isFile(`${filename}.${platform}.${ext}`))\n  );\n};\n\nconst isTypeImport = (\n  node: ImportDeclaration | ExportNamedDeclaration | ExportAllDeclaration\n) =>\n  ('importKind' in node && node.importKind === 'type') ||\n  ('exportKind' in node && node.exportKind === 'type');\n\nconst assertFilename: (\n  filename: string | null | undefined\n) => asserts filename is string = (filename) => {\n  if (filename == null) {\n    throw new Error(\"Couldn't find a filename for the current file.\");\n  }\n};\n\nexport default function (\n  api: ConfigAPI,\n  {\n    extension,\n    platforms = [\n      'native',\n      'android',\n      'ios',\n      'windows',\n      'macos',\n      'visionos',\n      'web',\n      'tv',\n      'android.tv',\n      'ios.tv',\n    ],\n  }: Options\n): PluginObj {\n  api.assertVersion(7);\n\n  const codegenEnabled = api.caller((caller) => caller?.codegenEnabled);\n\n  function addExtension(\n    {\n      node,\n    }: NodePath<\n      ImportDeclaration | ExportNamedDeclaration | ExportAllDeclaration\n    >,\n    state: PluginPass\n  ) {\n    if (\n      extension == null ||\n      // Skip type imports as they'll be removed\n      isTypeImport(node) ||\n      // Skip non-relative imports\n      !node.source?.value.startsWith('.')\n    ) {\n      return;\n    }\n\n    assertFilename(state.filename);\n\n    const filename = path.resolve(\n      path.dirname(state.filename),\n      node.source.value\n    );\n\n    // Skip imports for codegen spec if codegen is enabled\n    if (\n      codegenEnabled &&\n      (isCodegenSpec(filename) ||\n        extensions.some((ext) => isCodegenSpec(`${filename}.${ext}`)))\n    ) {\n      return;\n    }\n\n    // Replace .ts extension with .js if file with extension is explicitly imported\n    if (isFile(filename)) {\n      node.source.value = node.source.value.replace(/\\.tsx?$/, `.${extension}`);\n      return;\n    }\n\n    // Add extension if .ts file or file with extension exists\n    // And no platform specific file exists\n    if (isModuleWithoutPlatform(filename, extension, platforms)) {\n      node.source.value += `.${extension}`;\n      return;\n    }\n\n    // Expand folder imports to index and add extension\n    if (\n      isDirectory(filename) &&\n      isModuleWithoutPlatform(\n        path.join(filename, 'index'),\n        extension,\n        platforms\n      )\n    ) {\n      node.source.value = node.source.value.replace(\n        /\\/?$/,\n        `/index.${extension}`\n      );\n      return;\n    }\n  }\n\n  return {\n    name: 'react-native-builder-bob',\n    visitor: {\n      ImportDeclaration(path, state) {\n        addExtension(path, state);\n      },\n      ExportNamedDeclaration(path, state) {\n        addExtension(path, state);\n      },\n      ExportAllDeclaration(path, state) {\n        addExtension(path, state);\n      },\n    },\n  };\n}\n"],"mappings":"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","ignoreList":[]}