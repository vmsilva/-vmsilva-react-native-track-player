{"version":3,"file":"patchCodegenAndroidPackage.js","names":["_fsExtra","_interopRequireDefault","require","_path","_kleur","e","__esModule","default","CODEGEN_DOCS","exports","patchCodegenAndroidPackage","projectPath","packageJson","report","codegenAndroidPath","codegenConfig","outputDir","android","Error","path","resolve","fs","pathExists","codegenJavaPackageName","javaPackageName","codegenJavaPath","info","kleur","blue","relative","javaFiles","readdir","Promise","all","map","file","filePath","fileContent","readFile","newFileContent","replace","writeFile","newPackagePath","mkdir","recursive","newFilePath","rename","rm"],"sources":["../../../../src/targets/codegen/patches/patchCodegenAndroidPackage.ts"],"sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport type { Report } from '../../../types';\nimport kleur from 'kleur';\n\nexport const CODEGEN_DOCS =\n  'https://reactnative.dev/docs/the-new-architecture/using-codegen#configuring-codegen';\n\n/**\n * Currently, running react-native codegen generates java files with package name `com.facebook.fbreact.specs`.\n * This is a known issue in react-native itself.\n * You can find the relevant line here: https://github.com/facebook/react-native/blob/dc460147bb00d6f912cc0a829f8040d85faeeb13/packages/react-native/scripts/codegen/generate-artifacts-executor.js#L459.\n * To workaround, this function renames the package name to the one provided in the codegenConfig.\n * @throws if codegenConfig.outputDir.android or codegenConfig.android.javaPackageName is not defined in package.json\n * @throws if the codegenAndroidPath does not exist\n */\nexport async function patchCodegenAndroidPackage(\n  projectPath: string,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  packageJson: any,\n  report: Report\n) {\n  let codegenAndroidPath: string | undefined =\n    packageJson.codegenConfig?.outputDir?.android;\n  if (!codegenAndroidPath) {\n    throw new Error(\n      `Your package.json doesn't contain codegenConfig.outputDir.android. Please see ${CODEGEN_DOCS}`\n    );\n  }\n  codegenAndroidPath = path.resolve(projectPath, codegenAndroidPath);\n\n  if (!(await fs.pathExists(codegenAndroidPath))) {\n    throw new Error(\n      `The codegen android path defined in your package.json: ${codegenAndroidPath} doesn't exist.`\n    );\n  }\n\n  const codegenJavaPackageName: string | undefined =\n    packageJson.codegenConfig.android.javaPackageName;\n  if (!codegenJavaPackageName) {\n    throw new Error(\n      `Your package.json doesn't contain codegenConfig.android.javaPackageName. Please see ${CODEGEN_DOCS}`\n    );\n  }\n\n  const codegenJavaPath = path.resolve(\n    codegenAndroidPath,\n    `java/com/facebook/fbreact/specs`\n  );\n\n  // If this issue is ever fixed in react-native, this check will prevent the patching from running.\n  if (!(await fs.pathExists(codegenJavaPath))) {\n    report.info(\n      `Could not find ${kleur.blue(\n        path.relative(projectPath, codegenJavaPath)\n      )}. Skipping patching codegen java files.`\n    );\n    return;\n  }\n\n  const javaFiles = await fs.readdir(codegenJavaPath);\n\n  await Promise.all(\n    javaFiles.map(async (file) => {\n      const filePath = path.resolve(codegenJavaPath, file);\n      const fileContent = await fs.readFile(filePath, 'utf8');\n\n      const newFileContent = fileContent.replace(\n        'package com.facebook.fbreact.specs',\n        `package ${codegenJavaPackageName}`\n      );\n\n      await fs.writeFile(filePath, newFileContent);\n    })\n  );\n\n  const newPackagePath = path.resolve(\n    codegenAndroidPath,\n    `java/${codegenJavaPackageName.replace(/\\./g, '/')}`\n  );\n\n  if (!(await fs.pathExists(newPackagePath))) {\n    await fs.mkdir(newPackagePath, { recursive: true });\n  }\n\n  await Promise.all(\n    javaFiles.map(async (file) => {\n      const filePath = path.resolve(codegenJavaPath, file);\n      const newFilePath = path.resolve(newPackagePath, file);\n\n      await fs.rename(filePath, newFilePath);\n    })\n  );\n\n  if (\n    await fs.pathExists(\n      path.resolve(codegenAndroidPath, 'java/com/facebook/react/viewmanagers')\n    )\n  ) {\n    // Keep the view managers\n    await fs.rm(path.resolve(codegenAndroidPath, 'java/com/facebook/fbreact'), {\n      recursive: true,\n    });\n  } else {\n    // Delete the entire facebook namespace\n    await fs.rm(path.resolve(codegenAndroidPath, 'java/com/facebook'), {\n      recursive: true,\n    });\n  }\n}\n"],"mappings":";;;;;;;AAAA,IAAAA,QAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,KAAA,GAAAF,sBAAA,CAAAC,OAAA;AAEA,IAAAE,MAAA,GAAAH,sBAAA,CAAAC,OAAA;AAA0B,SAAAD,uBAAAI,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAEnB,MAAMG,YAAY,GAAAC,OAAA,CAAAD,YAAA,GACvB,qFAAqF;;AAEvF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,eAAeE,0BAA0BA,CAC9CC,WAAmB;AACnB;AACAC,WAAgB,EAChBC,MAAc,EACd;EACA,IAAIC,kBAAsC,GACxCF,WAAW,CAACG,aAAa,EAAEC,SAAS,EAAEC,OAAO;EAC/C,IAAI,CAACH,kBAAkB,EAAE;IACvB,MAAM,IAAII,KAAK,CACb,iFAAiFV,YAAY,EAC/F,CAAC;EACH;EACAM,kBAAkB,GAAGK,aAAI,CAACC,OAAO,CAACT,WAAW,EAAEG,kBAAkB,CAAC;EAElE,IAAI,EAAE,MAAMO,gBAAE,CAACC,UAAU,CAACR,kBAAkB,CAAC,CAAC,EAAE;IAC9C,MAAM,IAAII,KAAK,CACb,0DAA0DJ,kBAAkB,iBAC9E,CAAC;EACH;EAEA,MAAMS,sBAA0C,GAC9CX,WAAW,CAACG,aAAa,CAACE,OAAO,CAACO,eAAe;EACnD,IAAI,CAACD,sBAAsB,EAAE;IAC3B,MAAM,IAAIL,KAAK,CACb,uFAAuFV,YAAY,EACrG,CAAC;EACH;EAEA,MAAMiB,eAAe,GAAGN,aAAI,CAACC,OAAO,CAClCN,kBAAkB,EAClB,iCACF,CAAC;;EAED;EACA,IAAI,EAAE,MAAMO,gBAAE,CAACC,UAAU,CAACG,eAAe,CAAC,CAAC,EAAE;IAC3CZ,MAAM,CAACa,IAAI,CACT,kBAAkBC,cAAK,CAACC,IAAI,CAC1BT,aAAI,CAACU,QAAQ,CAAClB,WAAW,EAAEc,eAAe,CAC5C,CAAC,yCACH,CAAC;IACD;EACF;EAEA,MAAMK,SAAS,GAAG,MAAMT,gBAAE,CAACU,OAAO,CAACN,eAAe,CAAC;EAEnD,MAAMO,OAAO,CAACC,GAAG,CACfH,SAAS,CAACI,GAAG,CAAC,MAAOC,IAAI,IAAK;IAC5B,MAAMC,QAAQ,GAAGjB,aAAI,CAACC,OAAO,CAACK,eAAe,EAAEU,IAAI,CAAC;IACpD,MAAME,WAAW,GAAG,MAAMhB,gBAAE,CAACiB,QAAQ,CAACF,QAAQ,EAAE,MAAM,CAAC;IAEvD,MAAMG,cAAc,GAAGF,WAAW,CAACG,OAAO,CACxC,oCAAoC,EACpC,WAAWjB,sBAAsB,EACnC,CAAC;IAED,MAAMF,gBAAE,CAACoB,SAAS,CAACL,QAAQ,EAAEG,cAAc,CAAC;EAC9C,CAAC,CACH,CAAC;EAED,MAAMG,cAAc,GAAGvB,aAAI,CAACC,OAAO,CACjCN,kBAAkB,EAClB,QAAQS,sBAAsB,CAACiB,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,EACpD,CAAC;EAED,IAAI,EAAE,MAAMnB,gBAAE,CAACC,UAAU,CAACoB,cAAc,CAAC,CAAC,EAAE;IAC1C,MAAMrB,gBAAE,CAACsB,KAAK,CAACD,cAAc,EAAE;MAAEE,SAAS,EAAE;IAAK,CAAC,CAAC;EACrD;EAEA,MAAMZ,OAAO,CAACC,GAAG,CACfH,SAAS,CAACI,GAAG,CAAC,MAAOC,IAAI,IAAK;IAC5B,MAAMC,QAAQ,GAAGjB,aAAI,CAACC,OAAO,CAACK,eAAe,EAAEU,IAAI,CAAC;IACpD,MAAMU,WAAW,GAAG1B,aAAI,CAACC,OAAO,CAACsB,cAAc,EAAEP,IAAI,CAAC;IAEtD,MAAMd,gBAAE,CAACyB,MAAM,CAACV,QAAQ,EAAES,WAAW,CAAC;EACxC,CAAC,CACH,CAAC;EAED,IACE,MAAMxB,gBAAE,CAACC,UAAU,CACjBH,aAAI,CAACC,OAAO,CAACN,kBAAkB,EAAE,sCAAsC,CACzE,CAAC,EACD;IACA;IACA,MAAMO,gBAAE,CAAC0B,EAAE,CAAC5B,aAAI,CAACC,OAAO,CAACN,kBAAkB,EAAE,2BAA2B,CAAC,EAAE;MACzE8B,SAAS,EAAE;IACb,CAAC,CAAC;EACJ,CAAC,MAAM;IACL;IACA,MAAMvB,gBAAE,CAAC0B,EAAE,CAAC5B,aAAI,CAACC,OAAO,CAACN,kBAAkB,EAAE,mBAAmB,CAAC,EAAE;MACjE8B,SAAS,EAAE;IACb,CAAC,CAAC;EACJ;AACF","ignoreList":[]}